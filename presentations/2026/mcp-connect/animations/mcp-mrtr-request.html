<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: transparent;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100vw;
      height: 100vh;
      font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
      padding: 0;
      overflow: hidden;
    }
    
    .api-window {
      background: linear-gradient(135deg, #1e1e1e 0%, #252526 100%);
      border-radius: 16px;
      padding: 12px;
      width: 480px;
      height: 460px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .api-header {
      color: #888;
      font-size: 11px;
      margin-bottom: 4px;
      padding-bottom: 3px;
      border-bottom: 1px solid #333;
    }

    .request-label {
      color: #569cd6;
      font-size: 10px;
      margin-bottom: 2px;
      opacity: 0;
    }
    .request-label.show { animation: fadeIn 0.3s ease forwards; }
    .request-label.fade-out { animation: fadeOut 0.8s ease forwards; }

    .api-content {
      font-size: 10px;
      line-height: 1.3;
      flex: 1;
      overflow: auto;
      padding-right: 6px;
      scrollbar-width: none;
    }

    .api-content::-webkit-scrollbar {
      display: none;
    }

    .json-brace { color: #d4d4d4; }
    .json-key { color: #9cdcfe; }
    .json-string { color: #ce9178; }
    .json-bracket { color: #d4d4d4; }
    .json-bool { color: #569cd6; }
    
    .msg-block {
      opacity: 0;
      transform: translateX(-10px);
      margin: 1px 0;
      padding: 1px 0 1px 6px;
      color: #d4d4d4;
    }

    .msg-block.show {
      animation: slideInLeft 0.4s ease forwards;
    }

    .msg-block.fade-out {
      animation: fadeOut 0.8s ease forwards;
    }

    .msg-block.client-req { border-left: 2px solid #0b93f6; }
    .msg-block.server-req { border-left: 2px solid #f5a623; }
    .msg-block.client-resp { border-left: 2px solid #34c759; }

    .static-content {
      opacity: 0;
    }
    .static-content.show { animation: fadeIn 0.3s ease forwards; }
    .static-content.fade-out { animation: fadeOut 0.8s ease forwards; }

    .request-group {
      margin-bottom: 2px;
      padding-bottom: 2px;
      border-bottom: 1px dashed #333;
    }

    .request-group:last-child {
      border-bottom: none;
    }

    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    .dim { opacity: 0.5; }
  </style>
</head>
<body>
  <div class="api-window canvas-root">
    <div class="api-header">POST /mcp (Client → Server)</div>
    <div class="api-content">
      
      <!-- Request 1: Initial CallToolRequest -->
      <div class="request-group">
        <div class="request-label" data-delay="0">Request #1 — tools/call</div>
        <div class="msg-block client-req" data-delay="0">
          <span class="json-brace">{</span><br>
          &nbsp;&nbsp;<span class="json-key">"jsonrpc"</span>: <span class="json-string">"2.0"</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"id"</span>: <span class="json-string">1</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"method"</span>: <span class="json-string">"tools/call"</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"params"</span>: <span class="json-brace">{</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"name"</span>: <span class="json-string">"deploy_app"</span>,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"arguments"</span>: <span class="json-brace">{</span> <span class="json-key">"env"</span>: <span class="json-string">"production"</span> <span class="json-brace">}</span><br>
          &nbsp;&nbsp;<span class="json-brace">}</span><br>
          <span class="json-brace">}</span>
        </div>
      </div>

      <!-- Response 1: Incomplete result with dependent requests -->
      <div class="request-group">
        <div class="request-label" data-delay="2500">Response #1 — incomplete (dependent_requests)</div>
        <div class="msg-block server-req" data-delay="2500">
          <span class="json-brace">{</span><br>
          &nbsp;&nbsp;<span class="json-key">"jsonrpc"</span>: <span class="json-string">"2.0"</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"id"</span>: <span class="json-string">1</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"dependent_requests"</span>: <span class="json-brace">{</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"confirm"</span>: <span class="json-brace">{</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"method"</span>: <span class="json-string">"elicitation/create"</span>,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"params"</span>: <span class="json-brace">{</span> <span class="json-key">"message"</span>: <span class="json-string">"Confirm deploy?"</span>, <span class="json-key">"requestedSchema"</span>: <span class="json-brace">{</span> <span class="json-key">"type"</span>: <span class="json-string">"object"</span> <span class="json-brace">}</span> <span class="json-brace">}</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-brace">}</span><br>
          &nbsp;&nbsp;<span class="json-brace">}</span><br>
          <span class="json-brace">}</span>
        </div>
      </div>

      <!-- Request 2: Retry with dependent responses -->
      <div class="request-group">
        <div class="request-label" data-delay="5000">Request #2 — retry (elicitation response)</div>
        <div class="msg-block client-req" data-delay="5000">
          <span class="json-brace">{</span><br>
          &nbsp;&nbsp;<span class="json-key">"jsonrpc"</span>: <span class="json-string">"2.0"</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"id"</span>: <span class="json-string">2</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"method"</span>: <span class="json-string">"tools/call"</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"params"</span>: <span class="json-brace">{</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"name"</span>: <span class="json-string">"deploy_app"</span>,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"arguments"</span>: <span class="json-brace">{</span> <span class="json-key">"env"</span>: <span class="json-string">"production"</span> <span class="json-brace">}</span><br>
          &nbsp;&nbsp;<span class="json-brace">}</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"dependent_responses"</span>: <span class="json-brace">{</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"confirm"</span>: <span class="json-brace">{</span> <span class="json-key">"result"</span>: <span class="json-brace">{</span> <span class="json-key">"action"</span>: <span class="json-string">"accept"</span>, <span class="json-key">"content"</span>: <span class="json-brace">{</span> <span class="json-key">"confirmed"</span>: <span class="json-bool">true</span> <span class="json-brace">}</span> <span class="json-brace">}</span> <span class="json-brace">}</span><br>
          &nbsp;&nbsp;<span class="json-brace">}</span><br>
          <span class="json-brace">}</span>
        </div>
      </div>

      <!-- Response 2: Incomplete result with next dependent request -->
      <div class="request-group">
        <div class="request-label" data-delay="7500">Response #2 — sampling request (dependent_requests)</div>
        <div class="msg-block server-req" data-delay="7500">
          <span class="json-brace">{</span><br>
          &nbsp;&nbsp;<span class="json-key">"jsonrpc"</span>: <span class="json-string">"2.0"</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"id"</span>: <span class="json-string">2</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"dependent_requests"</span>: <span class="json-brace">{</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"summary"</span>: <span class="json-brace">{</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"method"</span>: <span class="json-string">"sampling/createMessage"</span>,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"params"</span>: <span class="json-brace">{</span> <span class="json-key">"messages"</span>: <span class="json-bracket">[</span> <span class="json-string">"..."</span> <span class="json-bracket">]</span>, <span class="json-key">"maxTokens"</span>: <span class="json-string">120</span> <span class="json-brace">}</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-brace">}</span><br>
          &nbsp;&nbsp;<span class="json-brace">}</span><br>
          <span class="json-brace">}</span>
        </div>
      </div>

      <div class="request-group">
        <div class="request-label" data-delay="10000">Request #3 — retry (sampling response added)</div>
        <div class="msg-block client-req" data-delay="10000">
          <span class="json-brace">{</span><br>
          &nbsp;&nbsp;<span class="json-key">"jsonrpc"</span>: <span class="json-string">"2.0"</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"id"</span>: <span class="json-string">3</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"method"</span>: <span class="json-string">"tools/call"</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"params"</span>: <span class="json-brace">{</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"name"</span>: <span class="json-string">"deploy_app"</span>,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"arguments"</span>: <span class="json-brace">{</span> <span class="json-key">"env"</span>: <span class="json-string">"production"</span> <span class="json-brace">}</span><br>
          &nbsp;&nbsp;<span class="json-brace">}</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"dependent_responses"</span>: <span class="json-brace">{</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"confirm"</span>: <span class="json-brace">{</span> <span class="json-key">"result"</span>: <span class="json-brace">{</span> <span class="json-key">"action"</span>: <span class="json-string">"accept"</span>, <span class="json-key">"content"</span>: <span class="json-brace">{</span> <span class="json-key">"confirmed"</span>: <span class="json-bool">true</span> <span class="json-brace">}</span> <span class="json-brace">}</span> <span class="json-brace">}</span>,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"summary"</span>: <span class="json-brace">{</span> <span class="json-key">"result"</span>: <span class="json-brace">{</span> <span class="json-key">"role"</span>: <span class="json-string">"assistant"</span>, <span class="json-key">"content"</span>: <span class="json-brace">{</span> <span class="json-key">"type"</span>: <span class="json-string">"text"</span>, <span class="json-key">"text"</span>: <span class="json-string">"Deploy summary..."</span> <span class="json-brace">}</span>, <span class="json-key">"model"</span>: <span class="json-string">"claude-3-sonnet"</span>, <span class="json-key">"stopReason"</span>: <span class="json-string">"endTurn"</span> <span class="json-brace">}</span> <span class="json-brace">}</span><br>
          &nbsp;&nbsp;<span class="json-brace">}</span><br>
          <span class="json-brace">}</span>
        </div>
      </div>

      <!-- Response 3: Final result -->
      <div class="request-group">
        <div class="request-label" data-delay="12500">Response #3 — CallToolResult</div>
        <div class="msg-block server-req" data-delay="12500">
          <span class="json-brace">{</span><br>
          &nbsp;&nbsp;<span class="json-key">"jsonrpc"</span>: <span class="json-string">"2.0"</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"id"</span>: <span class="json-string">3</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"result"</span>: <span class="json-brace">{</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"content"</span>: <span class="json-bracket">[</span> <span class="json-brace">{</span> <span class="json-key">"type"</span>: <span class="json-string">"text"</span>, <span class="json-key">"text"</span>: <span class="json-string">"Deployment queued."</span> <span class="json-brace">}</span> <span class="json-bracket">]</span>,<br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"isError"</span>: <span class="json-bool">false</span><br>
          &nbsp;&nbsp;<span class="json-brace">}</span><br>
          <span class="json-brace">}</span>
        </div>
      </div>

    </div>
  </div>

  <script src="shared/sequence-helpers.js"></script>
  <script src="shared/canvas-scale.js"></script>
  <script>
    const apiContent = document.querySelector('.api-content');
    const timelineItems = Array.from(document.querySelectorAll('.msg-block, .request-label'));
    const delays = timelineItems.map((item) => parseInt(item.dataset.delay, 10) || 0);
    const maxDelay = delays.length ? Math.max(...delays) : 0;
    const FADE_OUT_OFFSET = 2500;
    const CYCLE_PAUSE = 3500;
    const cycleDuration = maxDelay + FADE_OUT_OFFSET + 1000 + CYCLE_PAUSE;

    apiContent.scrollTop = 0;
    setInterval(() => {
      apiContent.scrollTop = 0;
    }, cycleDuration);

    runSequenceAnimation({
      selectors: ['.msg-block', '.request-label'],
      cyclePause: CYCLE_PAUSE,
      fadeOutOffset: FADE_OUT_OFFSET,
      initialDelay: 500,
      lastDelayOverride: 12500,
      onShow: (el) => {
        if (el.classList.contains('msg-block')) {
          el.scrollIntoView({ block: 'nearest' });
        }
      },
    });
    scaleCanvas();
  </script>
</body>
</html>
