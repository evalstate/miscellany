<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: transparent;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100vw;
      height: 100vh;
      font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
      padding: 0;
      overflow: hidden;
    }
    
    .api-window {
      background: linear-gradient(135deg, #1e1e1e 0%, #252526 100%);
      border-radius: 16px;
      padding: 16px;
      width: 480px;
      height: 460px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.3);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .api-header {
      color: #888;
      font-size: 12px;
      margin-bottom: 6px;
      padding-bottom: 4px;
      border-bottom: 1px solid #333;
    }

    .request-label {
      color: #569cd6;
      font-size: 11px;
      margin-bottom: 3px;
      opacity: 0;
    }
    .request-label.show { animation: fadeIn 0.3s ease forwards; }
    .request-label.fade-out { animation: fadeOut 0.8s ease forwards; }

    .api-content {
      font-size: 11px;
      line-height: 1.35;
      flex: 1;
      overflow: hidden;
      padding-right: 0;
      scrollbar-width: none;
    }

    .api-content::-webkit-scrollbar {
      display: none;
    }

    .json-brace { color: #d4d4d4; }
    .json-key { color: #9cdcfe; }
    .json-string { color: #ce9178; }
    .json-bracket { color: #d4d4d4; }
    .json-bool { color: #569cd6; }
    
    .msg-block {
      opacity: 0;
      transform: translateX(-10px);
      margin: 2px 0;
      padding: 2px 0 2px 8px;
      color: #d4d4d4;
    }

    .msg-block.show {
      animation: slideInLeft 0.4s ease forwards;
    }

    .msg-block.fade-out {
      animation: fadeOut 0.8s ease forwards;
    }

    .msg-block.client-req { border-left: 2px solid #0b93f6; }
    .msg-block.server-req { border-left: 2px solid #f5a623; }
    .msg-block.client-resp { border-left: 2px solid #34c759; }

    .static-content {
      opacity: 0;
    }
    .static-content.show { animation: fadeIn 0.3s ease forwards; }
    .static-content.fade-out { animation: fadeOut 0.8s ease forwards; }

    .request-group {
      margin-bottom: 4px;
      padding-bottom: 4px;
      border-bottom: 1px dashed #333;
    }

    .request-group:last-child {
      border-bottom: none;
    }

    @keyframes slideInLeft {
      from { opacity: 0; transform: translateX(-10px); }
      to { opacity: 1; transform: translateX(0); }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }

    .dim { opacity: 0.5; }
  </style>
</head>
<body>
  <div class="api-window canvas-root">
    <div class="api-header">POST /mcp (Client → Server)</div>
    <div class="api-content">
      
      <!-- Request 1: Initial CallToolRequest -->
      <div class="request-group">
        <div class="request-label" data-delay="0">Request #1 — tools/call</div>
        <div class="msg-block client-req" data-delay="0">
          <span class="json-brace">{</span><br>
          &nbsp;&nbsp;<span class="json-key">"method"</span>: <span class="json-string">"tools/call"</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"params"</span>: <span class="json-brace">{</span> <span class="json-key">"name"</span>: <span class="json-string">"deploy_app"</span>, <span class="json-key">"env"</span>: <span class="json-string">"production"</span> <span class="json-brace">}</span><br>
          <span class="json-brace">}</span>
        </div>
      </div>

      <!-- Response 1: Incomplete result with dependent requests -->
      <div class="request-group">
        <div class="request-label" data-delay="4000">Response #1 — incomplete (dependent_requests)</div>
        <div class="msg-block server-req" data-delay="4000">
          <span class="json-brace">{</span><br>
          &nbsp;&nbsp;<span class="json-key">"dependent_requests"</span>: <span class="json-brace">{</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"confirm"</span>: <span class="json-string">"elicitation/create"</span>, <span class="json-key">"summary"</span>: <span class="json-string">"sampling/createMessage"</span><br>
          &nbsp;&nbsp;<span class="json-brace">}</span><br>
          <span class="json-brace">}</span>
        </div>
      </div>

      <!-- Request 2: Retry with dependent responses -->
      <div class="request-group">
        <div class="request-label" data-delay="8000">Request #2 — retry (includes prior responses)</div>
        <div class="msg-block client-req" data-delay="8000">
          <span class="json-brace">{</span><br>
          &nbsp;&nbsp;<span class="json-key">"method"</span>: <span class="json-string">"tools/call"</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"params"</span>: <span class="json-brace">{</span> <span class="json-key">"name"</span>: <span class="json-string">"deploy_app"</span> <span class="json-brace">}</span>,<br>
          &nbsp;&nbsp;<span class="json-key">"dependent_responses"</span>: <span class="json-brace">{</span><br>
          &nbsp;&nbsp;&nbsp;&nbsp;<span class="json-key">"confirm"</span>: <span class="json-string">"accept"</span>, <span class="json-key">"summary"</span>: <span class="json-string">"..."</span><br>
          &nbsp;&nbsp;<span class="json-brace">}</span><br>
          <span class="json-brace">}</span>
        </div>
      </div>

      <!-- Response 2: Final result -->
      <div class="request-group">
        <div class="request-label" data-delay="11000">Response #2 — CallToolResult</div>
        <div class="msg-block server-req" data-delay="11000">
          <span class="json-brace">{</span><br>
          &nbsp;&nbsp;<span class="json-key">"result"</span>: <span class="json-brace">{</span> <span class="json-key">"status"</span>: <span class="json-string">"success"</span> <span class="json-brace">}</span><br>
          <span class="json-brace">}</span>
        </div>
      </div>

    </div>
  </div>

  <script src="shared/sequence-helpers.js"></script>
  <script src="shared/canvas-scale.js"></script>
  <script>
    runSequenceAnimation({
      selectors: ['.msg-block', '.request-label'],
      cyclePause: 3000,
      fadeOutOffset: 4000,
      initialDelay: 500,
      lastDelayOverride: 11000,
    });
    scaleCanvas();
  </script>
</body>
</html>
